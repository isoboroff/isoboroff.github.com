<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta charset="utf-8"><meta name="description" content="a passionate tale of a daring rescue from a burning house"><meta name="author" content="Ian Soboroff"><title>Getting large collections into Lucene via SequenceFiles | In No Particular Order</title><link href="../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="../assets/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"><link href="../assets/css/rst.css" rel="stylesheet" type="text/css"><link href="../assets/css/code.css" rel="stylesheet" type="text/css"><link href="../assets/css/colorbox.css" rel="stylesheet" type="text/css"><link href="../assets/css/theme.css" rel="stylesheet" type="text/css"><!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]--><link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml"></head><body>
<!-- Menubar -->
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">

        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </a>

            <a class="brand" href="../">
            In No Particular Order
            </a>
            <!-- Everything you want hidden at 940px or less, place within here -->
            <div class="nav-collapse collapse">
                <ul class="nav"><li><a href="../archive.html">Archives</a>
            </li><li><a href="../categories/index.html">Tags</a>
            </li><li><a href="../rss.xml">RSS</a>

                </li></ul><ul class="nav pull-right"><li>
    <a href="getting-large-collections-into-lucene-via-seq.md" id="sourcelink">Source</a>
    </li>

                </ul></div>
        </div>
    </div>
</div>
<!-- End of Menubar -->
<div class="container-fluid" id="container-fluid">
    <!--Body content-->
    <div class="row-fluid">
    <div class="span2"></div>
    <div class="span8">
    
    <div class="postbox">
    
    <h1>Getting large collections into Lucene via SequenceFiles</h1>

    <hr><small>
        Posted: <time class="published" datetime="2011-04-08T10:15:23-07:00">2011-04-08 10:15</time>
        

        
          |  More posts about
            <a class="tag" href="../categories/clueweb.html"><span class="badge badge-info">clueweb</span></a>
            <a class="tag" href="../categories/hadoop.html"><span class="badge badge-info">hadoop</span></a>
            <a class="tag" href="../categories/lucene.html"><span class="badge badge-info">lucene</span></a>

    </small>
    <hr><p>I had a problem while setting up my indexing job for the ClueWeb09 collection. I wanted to do it from a MapReduce job: take each document, break it down into indexable chunks (title, URL, metadata, text, anchors) keyed by URL, sort around to accumulate the anchors for each document, then dump to an IndexWriter writing to local storage in the reduce phase.</p>
<p>Great idea, only Lucene would get into long periods of juggling files in the FSDirectory, and the reduce jobs would time out. My cluster would run 36 reduce jobs, and each one at the end (using the different process I'm about to describe) produced a 55GB index of around 14 million documents. Maybe this was expected, maybe not.</p>
<p>So here's what I did instead: the indexable chunks are sorted down in the reduce phase and written out to LZO-compressed SequenceFiles. Here's how it works... this code is too closely tied up in our larger IR system to easily post the code up to a repository, so you'll have to make do with snippets and pseudocode this time around.</p>
<p>The Mapper job takes each document, parses out the headers, text, anchors, bacon, and coffee, and puts each one into what I call a ParseTuple. A ParseTuple is a (key, value) pair. Note that this is a simple WritableComparable.</p>
<div class="code"><pre><span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">IOException</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">DataInput</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">DataOutput</span><span class="p">;</span>

<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">hadoop</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">Text</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">hadoop</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">WritableComparable</span><span class="p">;</span>

<span class="n">public</span> <span class="n">class</span> <span class="n">ParseTuple</span> <span class="n">implements</span> <span class="n">WritableComparable</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">ParseTuple</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="p">{</span>
    <span class="n">protected</span> <span class="n">String</span> <span class="n">label</span><span class="p">;</span>
    <span class="n">protected</span> <span class="n">String</span> <span class="n">data</span><span class="p">;</span>

    <span class="n">public</span> <span class="nf">ParseTuple</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">null</span><span class="p">;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">null</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">public</span> <span class="nf">ParseTuple</span><span class="p">(</span><span class="n">String</span> <span class="n">a</span><span class="p">,</span> <span class="n">String</span> <span class="n">b</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">b</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">public</span> <span class="kt">void</span> <span class="nf">write</span><span class="p">(</span><span class="n">DataOutput</span> <span class="n">out</span><span class="p">)</span> <span class="n">throws</span> <span class="n">IOException</span> <span class="p">{</span>
        <span class="n">Text</span><span class="p">.</span><span class="n">writeString</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">label</span><span class="p">);</span>
        <span class="n">Text</span><span class="p">.</span><span class="n">writeString</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">data</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">public</span> <span class="kt">void</span> <span class="n">readFields</span><span class="p">(</span><span class="n">DataInput</span> <span class="n">in</span><span class="p">)</span> <span class="n">throws</span> <span class="n">IOException</span> <span class="p">{</span>
        <span class="n">label</span> <span class="o">=</span> <span class="n">Text</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="n">in</span><span class="p">);</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">Text</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="n">in</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">public</span> <span class="k">static</span> <span class="n">ParseTuple</span> <span class="n">read</span><span class="p">(</span><span class="n">DataInput</span> <span class="n">in</span><span class="p">)</span> <span class="n">throws</span> <span class="n">IOException</span> <span class="p">{</span>
        <span class="n">ParseTuple</span> <span class="n">pt</span> <span class="o">=</span> <span class="n">new</span> <span class="n">ParseTuple</span><span class="p">();</span>
        <span class="n">pt</span><span class="p">.</span><span class="n">readFields</span><span class="p">(</span><span class="n">in</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">pt</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">public</span> <span class="kt">int</span> <span class="n">compareTo</span><span class="p">(</span><span class="n">ParseTuple</span> <span class="n">other</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">label</span><span class="p">.</span><span class="n">equals</span><span class="p">(</span><span class="s">"ptext"</span><span class="p">))</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">equals</span><span class="p">(</span><span class="s">"ptext"</span><span class="p">))</span>
            <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="n">label</span><span class="p">.</span><span class="n">compareTo</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">label</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">public</span> <span class="n">String</span> <span class="n">toString</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">new</span> <span class="n">String</span><span class="p">(</span><span class="n">label</span> <span class="o">+</span> <span class="s">":"</span> <span class="o">+</span> <span class="n">data</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>The Mapper class as you know emits (key, value) pairs.  In this case, the mapper maps documents to (URL, ParseTuple) pairs.  The keys inside each ParseTuple are used to identify how I want each tuple indexed - what Lucene Field, essentially, the data should go into.</p>
<p>The Reducer is going to compile all the ParseTuples for a given URL into what I call a DocBits.  Again, it's a simple serializable Map, so that the reducer can emit a single value for each URL.  Here's DocBits:</p>
<div class="code"><pre><span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">IOException</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">DataInput</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">DataOutput</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">HashMap</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">Map</span><span class="p">;</span>

<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">hadoop</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">Text</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">hadoop</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">Writable</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">hadoop</span><span class="p">.</span><span class="n">mapreduce</span><span class="p">.</span><span class="n">Reducer</span><span class="p">;</span>

<span class="n">public</span> <span class="n">class</span> <span class="n">DocBits</span> <span class="n">implements</span> <span class="n">Writable</span> <span class="p">{</span>
    <span class="n">protected</span> <span class="n">HashMap</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">map</span><span class="p">;</span>

    <span class="n">public</span> <span class="nf">DocBits</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">map</span> <span class="o">=</span> <span class="n">new</span> <span class="n">HashMap</span><span class="p">();</span>
    <span class="p">}</span>
    <span class="n">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="p">(</span><span class="n">String</span> <span class="n">k</span><span class="p">,</span> <span class="n">String</span> <span class="n">v</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">map</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">public</span> <span class="kt">void</span> <span class="nf">add</span><span class="p">(</span><span class="n">ParseTuple</span> <span class="n">p</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">map</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="n">label</span><span class="p">,</span> <span class="n">p</span><span class="p">.</span><span class="n">data</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">public</span> <span class="kt">void</span> <span class="n">write</span><span class="p">(</span><span class="n">DataOutput</span> <span class="n">out</span><span class="p">)</span> <span class="n">throws</span> <span class="n">IOException</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">Map</span><span class="p">.</span><span class="n">Entry</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">String</span><span class="p">,</span> <span class="n">String</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">e</span> <span class="o">:</span> <span class="n">map</span><span class="p">.</span><span class="n">entrySet</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">Text</span><span class="p">.</span><span class="n">writeString</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">getKey</span><span class="p">());</span>
            <span class="n">Text</span><span class="p">.</span><span class="n">writeString</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">getValue</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="n">Text</span><span class="p">.</span><span class="n">writeString</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="s">"EOD"</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="kt">void</span> <span class="n">readFields</span><span class="p">(</span><span class="n">DataInput</span> <span class="n">in</span><span class="p">)</span> <span class="n">throws</span> <span class="n">IOException</span> <span class="p">{</span>
        <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">String</span> <span class="n">k</span> <span class="o">=</span> <span class="n">Text</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="n">in</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">k</span><span class="p">.</span><span class="n">equals</span><span class="p">(</span><span class="s">"EOD"</span><span class="p">))</span>
                <span class="k">break</span><span class="p">;</span>
            <span class="n">String</span> <span class="n">v</span> <span class="o">=</span> <span class="n">Text</span><span class="p">.</span><span class="n">readString</span><span class="p">(</span><span class="n">in</span><span class="p">);</span>
            <span class="n">map</span><span class="p">.</span><span class="n">put</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">public</span> <span class="k">static</span> <span class="n">DocBits</span> <span class="n">read</span><span class="p">(</span><span class="n">DataInput</span> <span class="n">in</span><span class="p">)</span> <span class="n">throws</span> <span class="n">IOException</span> <span class="p">{</span>
        <span class="n">DocBits</span> <span class="n">db</span> <span class="o">=</span> <span class="n">new</span> <span class="n">DocBits</span><span class="p">();</span>
        <span class="n">db</span><span class="p">.</span><span class="n">readFields</span><span class="p">(</span><span class="n">in</span><span class="p">);</span>
        <span class="k">return</span> <span class="n">db</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>The Reducer is very simple:</p>
<div class="code"><pre><span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">IOException</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">Map</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">HashMap</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">regex</span><span class="p">.</span><span class="n">Pattern</span><span class="p">;</span>

<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">hadoop</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="n">Text</span><span class="p">;</span>
<span class="n">import</span> <span class="n">org</span><span class="p">.</span><span class="n">apache</span><span class="p">.</span><span class="n">hadoop</span><span class="p">.</span><span class="n">mapreduce</span><span class="p">.</span><span class="n">Reducer</span><span class="p">;</span>

<span class="n">public</span> <span class="n">class</span> <span class="n">ReduceParseTuplesToDocBits</span>
    <span class="n">extends</span> <span class="n">Reducer</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">Text</span><span class="p">,</span> <span class="n">ParseTuple</span><span class="p">,</span> <span class="n">Text</span><span class="p">,</span> <span class="n">DocBits</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="p">{</span>

    <span class="n">public</span> <span class="kt">void</span> <span class="n">reduce</span><span class="p">(</span><span class="n">Text</span> <span class="n">key</span><span class="p">,</span> <span class="n">Iterable</span><span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">ParseTuple</span><span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">values</span><span class="p">,</span> 
                       <span class="n">Context</span> <span class="n">context</span><span class="p">)</span>
        <span class="n">throws</span> <span class="n">IOException</span><span class="p">,</span> <span class="n">InterruptedException</span> <span class="p">{</span>

        <span class="n">DocBits</span> <span class="n">doc</span> <span class="o">=</span> <span class="n">new</span> <span class="n">DocBits</span><span class="p">();</span>
        <span class="n">StringBuilder</span> <span class="n">anchors</span> <span class="o">=</span> <span class="n">new</span> <span class="n">StringBuilder</span><span class="p">(</span><span class="mi">65536</span><span class="p">);</span>
        <span class="n">StringBuilder</span> <span class="n">title</span> <span class="o">=</span> <span class="n">new</span> <span class="n">StringBuilder</span><span class="p">(</span><span class="mi">8096</span><span class="p">);</span>
        <span class="n">boolean</span> <span class="n">have_parsed_doc</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>

        <span class="n">doc</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="s">"url"</span><span class="p">,</span> <span class="n">key</span><span class="p">.</span><span class="n">toString</span><span class="p">());</span>
        <span class="n">context</span><span class="p">.</span><span class="n">setStatus</span><span class="p">(</span><span class="n">key</span><span class="p">.</span><span class="n">toString</span><span class="p">());</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">ParseTuple</span> <span class="n">t</span><span class="o">:</span> <span class="n">values</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">equals</span><span class="p">(</span><span class="s">"ptext"</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">doc</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="s">"ptext"</span><span class="p">,</span> <span class="n">t</span><span class="p">.</span><span class="n">data</span><span class="p">);</span>
                <span class="n">have_parsed_doc</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">equals</span><span class="p">(</span><span class="s">"title"</span><span class="p">))</span>
                <span class="n">title</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">data</span><span class="p">).</span><span class="n">append</span><span class="p">(</span><span class="s">" "</span><span class="p">);</span>
            <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">label</span><span class="p">.</span><span class="n">equals</span><span class="p">(</span><span class="s">"anchor"</span><span class="p">)</span> <span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span><span class="o">&amp;</span><span class="n">amp</span><span class="p">;</span> <span class="n">anchors</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&amp;</span><span class="n">lt</span><span class="p">;</span> <span class="mi">65536</span><span class="p">)</span>
                <span class="n">anchors</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">.</span><span class="n">data</span><span class="p">).</span><span class="n">append</span><span class="p">(</span><span class="s">" "</span><span class="p">);</span>

            <span class="k">else</span>
                <span class="n">doc</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="n">t</span><span class="p">);</span>

            <span class="n">context</span><span class="p">.</span><span class="n">progress</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">have_parsed_doc</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">anchors</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">doc</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="s">"anchor"</span><span class="p">,</span> <span class="n">anchors</span><span class="p">.</span><span class="n">toString</span><span class="p">());</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">title</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">doc</span><span class="p">.</span><span class="n">add</span><span class="p">(</span><span class="s">"title"</span><span class="p">,</span> <span class="n">title</span><span class="p">.</span><span class="n">toString</span><span class="p">());</span>

            <span class="n">context</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">doc</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<p>The reducer has to be a little clever, because the Mapper will emit anchortext for documents that aren't in the collection.  We could actually index that if we wanted to, but we don't, since our job is only to search within the collection.</p>
<p>The main class that runs the job sets up the Mapper, Reducer, and the compressed SequenceFile:</p>
<div class="code"><pre>   <span class="n">public</span> <span class="kt">int</span> <span class="nf">run</span><span class="p">(</span><span class="n">String</span><span class="p">[]</span> <span class="n">args</span><span class="p">)</span> <span class="n">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="n">Configuration</span> <span class="n">conf</span> <span class="o">=</span> <span class="n">getConf</span><span class="p">();</span>

        <span class="n">Job</span> <span class="n">job</span> <span class="o">=</span> <span class="n">new</span> <span class="n">Job</span><span class="p">(</span><span class="n">conf</span><span class="p">,</span> <span class="s">"p3l.MapReduceIndexer"</span><span class="p">);</span>

        <span class="n">job</span><span class="p">.</span><span class="n">setJarByClass</span><span class="p">(</span><span class="n">this</span><span class="p">.</span><span class="n">getClass</span><span class="p">());</span>
        <span class="n">LOG</span><span class="p">.</span><span class="n">info</span><span class="p">(</span><span class="s">"Jar is "</span> <span class="o">+</span> <span class="n">job</span><span class="p">.</span><span class="n">getJar</span><span class="p">());</span>

        <span class="n">job</span><span class="p">.</span><span class="n">setMapperClass</span><span class="p">(</span><span class="n">MapWebDocToParseTuple</span><span class="p">.</span><span class="n">class</span><span class="p">);</span>
        <span class="n">job</span><span class="p">.</span><span class="n">setMapOutputKeyClass</span><span class="p">(</span><span class="n">Text</span><span class="p">.</span><span class="n">class</span><span class="p">);</span>
        <span class="n">job</span><span class="p">.</span><span class="n">setMapOutputValueClass</span><span class="p">(</span><span class="n">ParseTuple</span><span class="p">.</span><span class="n">class</span><span class="p">);</span>

        <span class="n">job</span><span class="p">.</span><span class="n">setReducerClass</span><span class="p">(</span><span class="n">ReduceParseTuplesToDocBits</span><span class="p">.</span><span class="n">class</span><span class="p">);</span>
        <span class="n">job</span><span class="p">.</span><span class="n">setOutputKeyClass</span><span class="p">(</span><span class="n">Text</span><span class="p">.</span><span class="n">class</span><span class="p">);</span>
        <span class="n">job</span><span class="p">.</span><span class="n">setOutputValueClass</span><span class="p">(</span><span class="n">DocBits</span><span class="p">.</span><span class="n">class</span><span class="p">);</span>

        <span class="n">job</span><span class="p">.</span><span class="n">setInputFormatClass</span><span class="p">(</span><span class="n">ClueWebInputFormat</span><span class="p">.</span><span class="n">class</span><span class="p">);</span> <span class="c1">// default</span>
        <span class="n">job</span><span class="p">.</span><span class="n">setOutputFormatClass</span><span class="p">(</span><span class="n">SequenceFileOutputFormat</span><span class="p">.</span><span class="n">class</span><span class="p">);</span>

        <span class="n">FileInputFormat</span><span class="p">.</span><span class="n">setInputPaths</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">new</span> <span class="n">Path</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">]));</span>
        <span class="n">SequenceFileOutputFormat</span><span class="p">.</span><span class="n">setOutputPath</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">new</span> <span class="n">Path</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]));</span>
        <span class="n">SequenceFileOutputFormat</span><span class="p">.</span><span class="n">setCompressOutput</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
        <span class="n">SequenceFileOutputFormat</span><span class="p">.</span><span class="n">setOutputCompressorClass</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">com</span><span class="p">.</span><span class="n">hadoop</span><span class="p">.</span><span class="n">compression</span><span class="p">.</span><span class="n">lzo</span><span class="p">.</span><span class="n">LzoCodec</span><span class="p">.</span><span class="n">class</span><span class="p">);</span>
        <span class="n">SequenceFileOutputFormat</span><span class="p">.</span><span class="n">setOutputCompressionType</span><span class="p">(</span><span class="n">job</span><span class="p">,</span> <span class="n">SequenceFile</span><span class="p">.</span><span class="n">CompressionType</span><span class="p">.</span><span class="n">BLOCK</span><span class="p">);</span>

        <span class="c1">// job.submit();</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">job</span><span class="p">.</span><span class="n">waitForCompletion</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="o">?</span> <span class="mi">0</span> <span class="o">:</span> <span class="mi">1</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>


<p>So at the end of this job, each Reducer has created a 26GB LZO-compressed SequenceFile ready to index:    </p>
<div class="code"><pre><span class="p">[</span><span class="n">soboroff</span><span class="err">@</span><span class="n">node1</span> <span class="o">~</span><span class="p">]</span><span class="err">$</span> <span class="n">hadoop</span> <span class="n">fs</span> <span class="o">-</span><span class="n">ls</span> <span class="n">clue</span>
<span class="n">Found</span> <span class="mi">38</span> <span class="n">items</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span>           <span class="mi">0</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">14</span><span class="o">:</span><span class="mi">09</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">_SUCCESS</span>
<span class="n">drwxrwxr</span><span class="o">-</span><span class="n">x</span>   <span class="o">-</span> <span class="n">soboroff</span> <span class="n">hadoop</span>           <span class="mi">0</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mo">07</span> <span class="mi">15</span><span class="o">:</span><span class="mi">38</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">_logs</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26327668533</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">18</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00000</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26339468375</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">18</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00001</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26330501868</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">17</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00002</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26366091781</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">14</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00003</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26321214072</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">16</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00004</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26349081494</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">18</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00005</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26343308176</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">28</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00006</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26352600382</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">24</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00007</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26321726649</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">18</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">0000</span><span class="mi">8</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26339094476</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">10</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">0000</span><span class="mi">9</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26321564045</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">16</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00010</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26343854112</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">10</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00011</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26315754762</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">15</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00012</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26346819081</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">18</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00013</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26364417290</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">10</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00014</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26345720864</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">15</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00015</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26325886676</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">19</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00016</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26352366823</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">16</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00017</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26363877289</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">10</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">0001</span><span class="mi">8</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26346838673</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">23</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">0001</span><span class="mi">9</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26334634232</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">18</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00020</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26338242486</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">15</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00021</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26333691832</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">11</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00022</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26351824723</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">13</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00023</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26340649075</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">14</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00024</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26348830107</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">11</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00025</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26341221269</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">17</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00026</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26318480301</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">09</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00027</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26314900021</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">22</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">0002</span><span class="mi">8</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26335481459</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">16</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">0002</span><span class="mi">9</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26329189695</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">22</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00030</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26347416304</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">14</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00031</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26340982688</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">27</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00032</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26327061702</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">18</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00033</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26331125728</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">12</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00034</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>   <span class="mi">3</span> <span class="n">soboroff</span> <span class="n">hadoop</span> <span class="mi">26328859269</span> <span class="mi">2011</span><span class="o">-</span><span class="mo">02</span><span class="o">-</span><span class="mi">08</span> <span class="mi">08</span><span class="o">:</span><span class="mi">09</span> <span class="o">/</span><span class="n">user</span><span class="o">/</span><span class="n">soboroff</span><span class="o">/</span><span class="n">clue</span><span class="o">/</span><span class="n">part</span><span class="o">-</span><span class="n">r</span><span class="o">-</span><span class="mo">00035</span>
</pre></div>


<p>And lastly, I have a stand-alone application which uses a SequenceFile.Reader to read each DocBits and build it into a Lucene Document, which gets passed on to an IndexWriter.  This application doesn't run under MapReduce, so I don't worry about Lucene timeouts.  Also, I have the entire collection preparsed, so I can easily shove those bits into HBase or any other system I want to.</p>
    
    <ul class="pager"><li class="previous">
            <a href="benchmarking-lzo-compression-in-hbase.html">← Previous post</a>
        </li>
        <li class="next">
            <a href="home-sweet-home.html">Next post →</a>
        </li>
    </ul><div id="disqus_thread"></div>
        <script type="text/javascript">
        var disqus_shortname ="nikolademo";
            var disqus_url="https://isoboroff.github.io//posts/getting-large-collections-into-lucene-via-seq.html";
        var disqus_title="Getting large collections into Lucene via SequenceFiles";
        var disqus_identifier="cache/posts/getting-large-collections-into-lucene-via-seq.html";
        var disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    

    </div>

    </div>
    </div>
    <!--End of body content-->
</div>
<div class="footerbox">
    Contents © 2013         <a href="mailto:isoboroff%20at%20gmail">Ian Soboroff</a> - Powered by         <a href="http://nikola.ralsina.com.ar">Nikola</a>
</div>

    <!-- Social buttons -->
    <div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
    <a class="addthis_button_more">Share</a>
    <ul><li><a class="addthis_button_facebook"></a>
    </li><li><a class="addthis_button_google_plusone_share"></a>
    </li><li><a class="addthis_button_linkedin"></a>
    </li><li><a class="addthis_button_twitter"></a>
    </li></ul></div>
    <script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script><!-- End of social buttons --><script src="../assets/js/jquery-1.7.2.min.js" type="text/javascript"></script><script src="../assets/js/bootstrap.min.js" type="text/javascript"></script><script src="../assets/js/jquery.colorbox-min.js" type="text/javascript"></script><script type="text/javascript">jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"80%",maxHeight:"80%",scalePhotos:true});</script></body></html>