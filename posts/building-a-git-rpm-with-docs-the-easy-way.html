<!DOCTYPE html><html lang="en"><head><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta charset="utf-8"><meta name="description" content=""><meta name="author" content="Joe Example"><title>Building a Git RPM with docs, the easy way | pseudo . posterous</title><link href="../assets/css/bootstrap.min.css" rel="stylesheet" type="text/css"><link href="../assets/css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css"><link href="../assets/css/rst.css" rel="stylesheet" type="text/css"><link href="../assets/css/code.css" rel="stylesheet" type="text/css"><link href="../assets/css/colorbox.css" rel="stylesheet" type="text/css"><link href="../assets/css/theme.css" rel="stylesheet" type="text/css"><!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]--><link rel="alternate" type="application/rss+xml" title="RSS" href="../rss.xml"></head><body>
<!-- Menubar -->
<div class="navbar navbar-fixed-top">
    <div class="navbar-inner">
        <div class="container">

        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </a>

            <a class="brand" href="../">
            pseudo . posterous
            </a>
            <!-- Everything you want hidden at 940px or less, place within here -->
            <div class="nav-collapse collapse">
                <ul class="nav"><li><a href="../archive.html">Archives</a>
            </li><li><a href="../categories/index.html">Tags</a>
            </li><li><a href="../rss.xml">RSS</a>

                </li></ul><ul class="nav pull-right"><li>
    <a href="building-a-git-rpm-with-docs-the-easy-way.wp" id="sourcelink">Source</a>
    </li>

                </ul></div>
        </div>
    </div>
</div>
<!-- End of Menubar -->
<div class="container-fluid" id="container-fluid">
    <!--Body content-->
    <div class="row-fluid">
    <div class="span2"></div>
    <div class="span8">
    
    <div class="postbox">
    
    <h1>Building a Git RPM with docs, the easy way</h1>

    <hr><small>
        Posted: <time class="published" datetime="2010-01-07T11:04:00-08:00">2010-01-07 11:04</time></small>
    <hr><p></p><p>I have been deploying git (<a href="http://git-scm.com/">http://git-scm.com/</a>) on various systems for a few years now.  It absolutely drives me nuts that in order to have manpages, you need some obscure toolchain (asciidoc/xmlto) which nothing else uses and moreover never seems to work on CentOS or OSX (our two platforms here at work).</p><p></p> Since I needed git RPMs for our new cluster, I spent a little time trying to solve this.  The toolchain is irreparable on CentOS, so the better solution is to have the git.spec file use the newly-compiled git(1) to fetch the precompiled documentation from the central git repository on <a href="http://kernel.org">kernel.org</a>, and fold that into the install.<p></p> Starting with the source RPM (<a href="http://kernel.org/pub/software/scm/git/RPMS/SRPMS/git-1.6.6-1.fc11.src.rpm">http://kernel.org/pub/software/scm/git/RPMS/SRPMS/git-1.6.6-1.fc11.src.rpm</a>), install it with 'rpm -ivh'.  Then patch the git.spec file with the following patch:<p></p> <span style="font-family: courier new,monospace;">--- git.spec    2009-12-23 19:00:24.000000000 -0500</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+++ git.spec-edit       2010-01-07 13:54:22.000000000 -0500</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">@@ -105,13 +105,26 @@</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;"> %build</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;"> make %{_smp_mflags} CFLAGS="$RPM_OPT_FLAGS" \&lt;/span&gt;<br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">      %{path_settings} \&lt;/span&gt;<br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">-     all %{!?_without_docs: doc}</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+     all</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+mkdir manual</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+cd manual</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+../git init</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+../git fetch-pack git://<a href="http://git.kernel.org/pub/scm/git/git.git">git.kernel.org/pub/scm/git/git.git</a> man html |</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+    while read a b</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+    do</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+        echo $a &gt;.git/$b</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+    done</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+cp .git/refs/heads/man .git/refs/heads/master</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+../git checkout -b v%{version}</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+cd ..</span><p></p> <span style="font-family: courier new,monospace;"> %install</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;"> rm -rf $RPM_BUILD_ROOT</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;"> make %{_smp_mflags} CFLAGS="$RPM_OPT_FLAGS" DESTDIR=$RPM_BUILD_ROOT \&lt;/span&gt;<br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">      %{path_settings} \&lt;/span&gt;<br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">      INSTALLDIRS=vendor install %{!?_without_docs: install-doc}</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+mv manual/man<em> $RPM_BUILD_ROOT%{_mandir}</em></span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;"> find $RPM_BUILD_ROOT -type f -name .packlist -exec rm -f {} ';'</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;"> find $RPM_BUILD_ROOT -type f -name '.bs' -empty -exec rm -f {} ';'</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;"> find $RPM_BUILD_ROOT -type f -name perllocal.pod -exec rm -f {} ';'</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">@@ -119,11 +132,7 @@</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;"> (find $RPM_BUILD_ROOT%{_bindir} -type f | grep -vE "archimport|svn|cvs|email|gitk|git-gui|git-citool" | sed -e s@^$RPM_BUILD_ROOT@@)               &gt; bin-man-doc-files</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;"> (find $RPM_BUILD_ROOT%{_libexecdir}/git-core -type f | grep -vE "archimport|svn|cvs|email|gitk|git-gui|git-citool" | sed -e s@^$RPM_BUILD_ROOT@@)               &gt;&gt; bin-man-doc-files</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;"> (find $RPM_BUILD_ROOT%{perl_vendorlib} -type f | sed -e s@^$RPM_BUILD_ROOT@@) &gt;&gt; perl-files</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">-%if %{!?_without_docs:1}0</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">-(find $RPM_BUILD_ROOT%{_mandir} $RPM_BUILD_ROOT/Documentation -type f | grep -vE "archimport|svn|git-cvs|email|gitk|git-gui|git-citool" | sed -e s@^$RPM_BUILD_ROOT@@ -e 's/$/<em>/' ) &gt;&gt; bin-man-doc-files</em></span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">-%else</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">-rm -rf $RPM_BUILD_ROOT%{_mandir}</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">-%endif</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+(find $RPM_BUILD_ROOT%{_mandir} -type f | sed -e s@^$RPM_BUILD_ROOT@@ -e 's/$//' ) &gt;&gt; bin-man-doc-files</span><p></p> <span style="font-family: courier new,monospace;"> %clean</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;"> rm -rf $RPM_BUILD_ROOT</span><p></p> <span style="font-family: arial,helvetica,sans-serif;">This patch does two things.  The first is that after compiling, it downloads the manpages for the correct version of git into a directory 'manual'.  This code basically comes straight from the git INSTALL file.  The second thing is during the install phase, it copies them to the right place, and notes them for inclusion in the RPM file.<p></p> Build the rpm with the command 'rpmbuild -bb git.spec --without docs'.<p></p>I think this behavior should be the default when building '--without docs', but I don't have the patience to subscribe to the mailing list and debate patches.  Hopefully someone else will find this useful.</span></span></span></span></span>
    
    <ul class="pager"><li class="previous">
            <a href="detection-theory-and-airport-screening.html">← Previous post</a>
        </li>
        <li class="next">
            <a href="ais-are-programs.html">Next post →</a>
        </li>
    </ul><div id="disqus_thread"></div>
        <script type="text/javascript">
        var disqus_shortname ="nikolademo";
            var disqus_url="http://foo.com/posts/building-a-git-rpm-with-docs-the-easy-way.html";
        var disqus_title="Building a Git RPM with docs, the easy way";
        var disqus_identifier="cache/posts/building-a-git-rpm-with-docs-the-easy-way.html";
        var disqus_config = function () {
            this.language = "en";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    

    </div>

    </div>
    </div>
    <!--End of body content-->
</div>
<div class="footerbox">
    Contents © 2013         <a href="mailto:joe@example.com">Joe Example</a> - Powered by         <a href="http://nikola.ralsina.com.ar">Nikola</a>
</div>

    <!-- Social buttons -->
    <div id="addthisbox" class="addthis_toolbox addthis_peekaboo_style addthis_default_style addthis_label_style addthis_32x32_style">
    <a class="addthis_button_more">Share</a>
    <ul><li><a class="addthis_button_facebook"></a>
    </li><li><a class="addthis_button_google_plusone_share"></a>
    </li><li><a class="addthis_button_linkedin"></a>
    </li><li><a class="addthis_button_twitter"></a>
    </li></ul></div>
    <script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js#pubid=ra-4f7088a56bb93798"></script><!-- End of social buttons --><script src="../assets/js/jquery-1.7.2.min.js" type="text/javascript"></script><script src="../assets/js/bootstrap.min.js" type="text/javascript"></script><script src="../assets/js/jquery.colorbox-min.js" type="text/javascript"></script><script type="text/javascript">jQuery("a.image-reference").colorbox({rel:"gal",maxWidth:"80%",maxHeight:"80%",scalePhotos:true});</script></body></html>