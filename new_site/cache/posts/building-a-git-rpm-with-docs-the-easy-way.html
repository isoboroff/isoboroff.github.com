<p><html><body><p>I have been deploying git (<a href="http://git-scm.com/">http://git-scm.com/</a>) on various systems for a few years now.  It absolutely drives me nuts that in order to have manpages, you need some obscure toolchain (asciidoc/xmlto) which nothing else uses and moreover never seems to work on CentOS or OSX (our two platforms here at work).</p><p></p> Since I needed git RPMs for our new cluster, I spent a little time trying to solve this.  The toolchain is irreparable on CentOS, so the better solution is to have the git.spec file use the newly-compiled git(1) to fetch the precompiled documentation from the central git repository on <a href="http://kernel.org">kernel.org</a>, and fold that into the install.<p></p> Starting with the source RPM (<a href="http://kernel.org/pub/software/scm/git/RPMS/SRPMS/git-1.6.6-1.fc11.src.rpm">http://kernel.org/pub/software/scm/git/RPMS/SRPMS/git-1.6.6-1.fc11.src.rpm</a>), install it with 'rpm -ivh'.  Then patch the git.spec file with the following patch:<p></p> <span style="font-family: courier new,monospace;">--- git.spec    2009-12-23 19:00:24.000000000 -0500</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+++ git.spec-edit       2010-01-07 13:54:22.000000000 -0500</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">@@ -105,13 +105,26 @@</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;"> %build</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;"> make %{_smp_mflags} CFLAGS="$RPM_OPT_FLAGS" \&lt;/span&gt;<br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">      %{path_settings} \&lt;/span&gt;<br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">-     all %{!?_without_docs: doc}</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+     all</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+mkdir manual</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+cd manual</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+../git init</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+../git fetch-pack git://<a href="http://git.kernel.org/pub/scm/git/git.git">git.kernel.org/pub/scm/git/git.git</a> man html |</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+    while read a b</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+    do</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+        echo $a &gt;.git/$b</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+    done</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+cp .git/refs/heads/man .git/refs/heads/master</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+../git checkout -b v%{version}</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+cd ..</span><p></p> <span style="font-family: courier new,monospace;"> %install</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;"> rm -rf $RPM_BUILD_ROOT</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;"> make %{_smp_mflags} CFLAGS="$RPM_OPT_FLAGS" DESTDIR=$RPM_BUILD_ROOT \&lt;/span&gt;<br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">      %{path_settings} \&lt;/span&gt;<br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">      INSTALLDIRS=vendor install %{!?_without_docs: install-doc}</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+mv manual/man<em> $RPM_BUILD_ROOT%{_mandir}</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;"> find $RPM_BUILD_ROOT -type f -name .packlist -exec rm -f {} ';'</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;"> find $RPM_BUILD_ROOT -type f -name '</em>.bs' -empty -exec rm -f {} ';'</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;"> find $RPM_BUILD_ROOT -type f -name perllocal.pod -exec rm -f {} ';'</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">@@ -119,11 +132,7 @@</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;"> (find $RPM_BUILD_ROOT%{_bindir} -type f | grep -vE "archimport|svn|cvs|email|gitk|git-gui|git-citool" | sed -e s@^$RPM_BUILD_ROOT@@)               &gt; bin-man-doc-files</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;"> (find $RPM_BUILD_ROOT%{_libexecdir}/git-core -type f | grep -vE "archimport|svn|cvs|email|gitk|git-gui|git-citool" | sed -e s@^$RPM_BUILD_ROOT@@)               &gt;&gt; bin-man-doc-files</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;"> (find $RPM_BUILD_ROOT%{perl_vendorlib} -type f | sed -e s@^$RPM_BUILD_ROOT@@) &gt;&gt; perl-files</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">-%if %{!?_without_docs:1}0</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">-(find $RPM_BUILD_ROOT%{_mandir} $RPM_BUILD_ROOT/Documentation -type f | grep -vE "archimport|svn|git-cvs|email|gitk|git-gui|git-citool" | sed -e s@^$RPM_BUILD_ROOT@@ -e 's/$/<em>/' ) &gt;&gt; bin-man-doc-files</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">-%else</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">-rm -rf $RPM_BUILD_ROOT%{_mandir}</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">-%endif</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">+(find $RPM_BUILD_ROOT%{_mandir} -type f | sed -e s@^$RPM_BUILD_ROOT@@ -e 's/$/</em>/' ) &gt;&gt; bin-man-doc-files</span><p></p> <span style="font-family: courier new,monospace;"> %clean</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;"> rm -rf $RPM_BUILD_ROOT</span><p></p> <span style="font-family: arial,helvetica,sans-serif;">This patch does two things.  The first is that after compiling, it downloads the manpages for the correct version of git into a directory 'manual'.  This code basically comes straight from the git INSTALL file.  The second thing is during the install phase, it copies them to the right place, and notes them for inclusion in the RPM file.<p></p> Build the rpm with the command 'rpmbuild -bb git.spec --without docs'.<p></p>I think this behavior should be the default when building '--without docs', but I don't have the patience to subscribe to the mailing list and debate patches.  Hopefully someone else will find this useful.</span></body></html></p>