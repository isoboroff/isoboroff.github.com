<p><html><body><p>I wanted a simple script to pull tweets from Twitter's gardenhose feed (the "sample API", as it's now called) and dump it in files, but couldn't find exactly what I needed online.?? Below is a tweak of the "spritz.py" example from the <a href="https://github.com/atl/twitstream">twitstream</a> Python library.?? Posting in case someone else finds it useful.</p><p></p> <br><span style="font-family: courier new,monospace;">#!/usr/bin/env python26</span><p></p><span style="font-family: courier new,monospace;"># The key module provided here:</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">import twitstream</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">from time import strftime, localtime</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">import json</span><p></p><span style="font-family: courier new,monospace;"># Provide documentation:</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">USAGE = """%prog [options] </span><p></p><span style="font-family: courier new,monospace;">Show a real-time subset of all twitter statuses."""</span><p></p> <span style="font-family: courier new,monospace;"># Define a function/callable called on every status:</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">class Store(object):</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????? def <strong>init</strong>(self):</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????????????? t = localtime()</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????????????? self.cur_hr = t.tm_hour</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????????????? self.cur_out = open(strftime("output.%d-%m-%y.%H", t), "w")</span><p></p> <span style="font-family: courier new,monospace;">?????? def <strong>call</strong>(self, status):</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????????????? t = localtime()</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????????????? if (t.tm_hour != self.cur_hr):</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????????????????????? if (not self.cur_out.closed):</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????????????????????????????? self.cur_out.close()</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????????????????????? self.cur_hr = t.tm_hour</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????????????????????? self.cur_out = open(strftime("output.%d-%m-%y.%H", localtime()), "w")</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????????????? </span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????????????? json.dump(status, self.cur_out)</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????????????? self.cur_out.write("\n")</span><p></p> <span style="font-family: courier new,monospace;">if <strong>name</strong> == '<strong>main</strong>':</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????? # Inherit the built in parser and use it to get credentials:</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????? parser = twitstream.parser</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????? parser.usage = USAGE</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????? (options, args) = parser.parse_args()</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????? twitstream.ensure_credentials(options)</span><p></p> <span style="font-family: courier new,monospace;">?????? cb = Store()</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????? </span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????? # Call a specific API method in the twitstream module: </span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????? stream = twitstream.spritzer(options.username, options.password, cb, </span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">???????????????????????????????????????????????????????????????? debug=options.debug, engine=options.engine)</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????? </span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????? # Loop forever on the streaming call:</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????? try:</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????????????? stream.run()</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????? finally:</span><br style="font-family: courier new,monospace;"><span style="font-family: courier new,monospace;">?????????????? cb.cur_out.close()</span></body></html></p>